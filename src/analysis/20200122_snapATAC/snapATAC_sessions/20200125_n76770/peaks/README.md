Commands to generate peaks (example for overlap, same for idr and for shuffled versions)
The shuffled version were generated by shuffling the cluster assignments as a control. This was done such that for each given cluster, the number of cells coming from a particular day was preserved, and hence the overall size of the clusters as well.

zcat ../croo/cluster_idx*/peak/overlap_reproducibility/overlap.optimal_peak.narrowPeak.gz > overlap.peaks.bed
python ~/kundajelab/heterokaryon-v2/src/utils/truncate_merged_peak_file_to_200bp_around_summit.py --input_bed overlap.peaks.bed  --summit_flank 100 --outf overlap.peaks.200.bed
bedtools sort -i overlap.peaks.200.bed  | bedtools merge -i stdin  > overlap.merged.200.bed

This was then merged with the peak set from the bulk run to get a bulk + cluster merged peak set:
cat <(cut -f1-3 ../../../../20200118_Bulk_Analysis/data/bulk_from_pipeline/overlap.counts.tsv | sed '1d') overlap.merged.200.bed | sort -k1,1 -k2,2n | bedtools merge -i stdin > bulk.cluster.overlap.merged.200.bed

